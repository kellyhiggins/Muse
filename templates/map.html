<!DOCTYPE html>


<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 

<html>
    <head>
        <title>Muse Map</title>
        <meta charset=utf-8 />
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
        <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
        <!-- bootstrap goes here -->

        <script src='https://code.jquery.com/jquery-1.11.0.min.js'>
        </script>
        <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:25%; bottom:0; width:75%; }
        </style>
    </head>

    <body>
        <form action ='/create-playlist' method="POST">
            <label><p>Where from?<input type="text" id="origin" placeholder="My current location">
            <a href="#" name="current_loc_playlist" data-toggle="tooltip" title="Make me a playlist based on my current location!">music-button</a>
            </label></p>
            <!-- when the user is done typing, geocoder submission shold happen to show the place on map -->
            <label><p>Where to?<input type="text" id="destination">
            </label></p>

            <a href="#" class="routing-btn" data-toggle="walk-tooltip" routing="walking" title="Make me a playlist based on a walk!">walk-button</a>
            <a href="#" class="routing-btn" data-toggle="bike-tooltip" routing="cycling" title="Make me a playlist based on a bikeride!">bike-button</a>
            <a href="#" class="routing-btn" data-toggle="drive-tooltip" data-routing="driving"title="Make me a playlist based on a drive!">drive-button</a>


            <!-- when one of these buttons is clicked, the map animates
            playlist replaces this div
            message flashes 'playlist added to your spotify account. enjoy the soundtrack for your journey!'
            small button should appear 'make another!' that will return this div -->
            
        </form>



        <div id='map'></div>

        <script>
        L.mapbox.accessToken = 'pk.eyJ1Ijoia2VsbHlhbm4iLCJhIjoiY2lvYmFqcnNlMDNwbnZ3bHpiZXlsYjVqbiJ9.0-hM3fi1TlEhf7pmXpfsrQ';

        var user_lat = 37.788681;
        var user_long = -122.411552;
        var user_timestamp = Date.now();

        getLocation();

        var map = L.mapbox.map('map', 'kellyann.dcbde2d4')
            .setView([user_lat, user_long], 13);

        var marker = new L.Marker(new L.LatLng(user_lat, user_long));
        map.addLayer(marker);

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getCoordinates);
            } else {
                console.log("geolocation not found!");
            }
        }

        function getCoordinates(position) {
            user_lat = position.coords.latitude;
            user_lon = position.coords.longitude;
            user_timestamp = position.timestamp;
        }

        $(document).ready(function() {
            $('[data-toggle="tooltip"]').tooltip();
        });

        var origin = $('#origin').val()
        var destination = $('#destination').val()

        function makeRoutePlaylist (evt) {
            $.post('/create-playlist.json'), {'origin': origin, 'destination': destination, 'routing': this.routing}, returnPlaylist);
        }

        $('.routing-btn').click(makeRoutePlaylist)


        // var geocoder = L.mapbox.geocoder('mapbox.places');

        // geocoder.query('current_location_input', showMap);

        // // Geocoder can return an area or a point (like a city or address).
        // // To handle both cases, the map bounds to an area or zooms to a point
        // function showMap(err, data) {
        //     if (data.lbounds) {
        //         map.fitBounds(data.lbounds);
        //     } else if (data.latlng) {
        //         map.setView([data.latlng[0], data.latlng[1]], 13);
        //     }
        // }



        // Adding a custom Marker
            // var marker = L.icon({
            //     iconUrl: 'https://bit.ly/QIMos7',
            //     iconAnchor: [20, 50]
            // });


        // Adding GeoJSON
            // L.mapbox.featureLayer()
            //     .loadURL('/help/data/examples/data.geojson')
            //     .addTo(map);


        // Adding Geocoder
        // var geocoder = L.mapbox.geocoder('mapbox.places-v1');
        // geocoder.query('New York City', showMap);

        // function showMap(err, data) {
        //     if (data.lbounds) {
        //         map.fitBounds(data.lbounds);
        //         var marker = L.marker([data.latlng[0], data.latlng[1]]).addTo(map);
        //     } else if (data.latlng) {
        //         map.setView([data.latlng[0], data.latlng[1]], 13);
        //     }
        // }


        // Event Handling
        // map.on('dblclick', function(e) {
        //     alert(e.latlng);
        // });




        // $(document).ready(getLocation);
        // function updateMarkerLocation(lat, long){
        //     marker.
            // change marker variable in 
            // Meggies' Advice create a hidden span that has the user_lat long,
// select as needed
// use dom as notebook that 
// wrap marker in updateMarkerLocation
        // }





        
        </script>
    </body>
</html>
